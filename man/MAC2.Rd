% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MAC2.R
\name{MAC2}
\alias{MAC2}
\title{Internal function for the Meta-Analytical Calibration Curve (MAC2)}
\usage{
MAC2(
  data = NULL,
  preds,
  y,
  cluster,
  grid,
  cl.level = 0.95,
  alpha.lr = 0.05/3,
  plot = TRUE,
  cluster_curves = FALSE,
  knots = 3,
  transf = "logit",
  method_choice = c("splines", "log", "loess"),
  method.tau = "REML",
  prediction = TRUE,
  random = TRUE,
  sm = "PLOGIT",
  hakn = FALSE,
  linewidth = 1,
  method.predict = "HTS",
  verbose = FALSE
)
}
\arguments{
\item{data}{Optional data frame containing the columns for `preds`, `y`, and `cluster`.
If provided, `preds`, `y`, and `cluster` should be column names (unquoted).
Default is `NULL`.}

\item{preds}{A numeric vector of predicted probabilities.}

\item{y}{A numeric vector of binary outcomes (0 or 1).}

\item{cluster}{A factor or character vector identifying cluster memberships.}

\item{grid}{the grid for the calibration curve evaluation}

\item{cl.level}{the confidence level for the calculation of the confidence interval. Default is \code{0.95}.}

\item{alpha.lr}{the alpha-level used for the likelihood ratio test, selecting the number of knots for the
restricted cubic splines}

\item{plot}{Logical; whether to plot the calibration curves. Default is `TRUE`.}

\item{cluster_curves}{Logical; whether to include cluster-specific curves in the plot. Default is `FALSE`.}

\item{knots}{Integer; number of knots for splines. Default is `3`.}

\item{transf}{Character; transformation for predictions: `"logit"` or `"identity"`. Default is `"logit"`.}

\item{method_choice}{Character; which method to use for meta-analysis. Options are:
`"log"`, `"loess"` or `"splines"`. Default is `"splines"`.}

\item{method.tau}{Character; method for between-study heterogeneity estimation. Default is `"REML"`.
This argument is passed to the  \code{\link[meta]{metagen}} function.}

\item{prediction}{Logical; whether to compute prediction intervals. Default is `TRUE`.
This argument is passed to the  \code{prediction} argument of the \code{\link[meta]{metagen}} function.}

\item{random}{Logical; whether to use random-effects model. Default is `TRUE`.
This argument is passed to the  \code{random} argument of the \code{\link[meta]{metagen}} function.}

\item{sm}{Character; summary measure for meta-analysis. Default is `"PLOGIT"`.
This argument is passed to the  \code{sm} argument of the \code{\link[meta]{metagen}} function.}

\item{hakn}{Logical; whether to use Hartung-Knapp adjustment. Default is `FALSE`.
This argument is passed to the  \code{method.random.ci} argument of the \code{\link[meta]{metagen}} function.}

\item{linewidth}{Numeric; line width for the meta-curve. Default is `1`.}

\item{method.predict}{Character; method for prediction intervals. Default is `"HTS"`.
This argument is passed to the  \code{method.predict} argument of the \code{\link[meta]{metagen}} function.}

\item{verbose}{logical, indicates whether progress has to be printed in the console.}
}
\value{
A list containing:
\describe{
  \item{cluster_data}{Data frame with linear predictors and standard errors for each method per cluster}
  \item{plot_data}{Data frame with meta-analysis results including predictions and intervals}
  \item{plot}{A `ggplot2` object if `plot = TRUE`, otherwise `NULL`}
}
}
\description{
Computes meta-analytical calibration curves using multiple methods (logistic regression,
loess or splines) and performs meta-analysis across clusters
to generate aggregated calibration curves with confidence and prediction intervals.
}
\details{
This function estimates the center-specific calibration curves using logistic regression,
loess or splines. Hereafter, it aggregates the calibration curves using meta-analytical techniques.
The meta-analysis is performed using the function \code{\link[meta]{metagen}} from the \code{\link[meta]{meta}}
package. The `method_choice` argument determines which method is for the meta-analytical aggregation.
}
