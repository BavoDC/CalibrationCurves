% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CGC.R
\name{CGC}
\alias{CGC}
\title{Internal function for the Clustered Grouped Calibration Curve (CGC)}
\usage{
CGC(
  data = NULL,
  preds,
  y,
  cluster,
  cl.level = 0.95,
  ntiles = 10,
  cluster_curves = FALSE,
  plot = TRUE,
  size = 1,
  linewidth = 0.4,
  univariate = FALSE,
  method = c("grouped", "interval")
)
}
\arguments{
\item{data}{Optional data frame containing the columns for `preds`, `y`, and `cluster`.
If provided, `preds`, `y`, and `cluster` should be column names (unquoted).
Default is `NULL`.}

\item{preds}{A numeric vector of predicted probabilities/values, or a column in `data`.}

\item{y}{A numeric vector of observed outcomes, or a column in `data`.}

\item{cluster}{A factor/character vector of cluster identifiers, or a column in `data`.}

\item{cl.level}{the confidence level for the calculation of the confidence interval. Default is \code{0.95}.}

\item{ntiles}{Integer; number of groups (tiles) for calibration. Default is `10`.}

\item{cluster_curves}{Logical; whether to include cluster-specific calibration
curves in the plot. Default is `FALSE`.}

\item{plot}{Logical; whether to return a calibration plot. Default is `TRUE`.}

\item{size}{Numeric; point size for plotted curves. Default is `1`.}

\item{linewidth}{Numeric; line width for plotted curves. Default is `0.4`.}

\item{univariate}{Logical; whether to use univariate meta-analysis. Default is `FALSE`.}

\item{method}{Character; grouping method: \code{"grouped"} (equal-sized groups) or
\code{"interval"} (interval-based). Default is \code{"grouped"}.}
}
\value{
A list containing:
\describe{
  \item{plot_data}{Data frame of meta-analysis calibration estimates.}
  \item{trad_grouped}{Data frame with traditional grouped calibration results.}
  \item{observed_data}{Data frame with per-observation calibration data.}
  \item{cluster_data}{Data frame with cluster-specific calibration summaries.}
  \item{plot}{A `ggplot2` object if `plot = TRUE`, otherwise `NULL`.}
}
}
\description{
Generates a flexible calibration curve using predicted values, observed outcomes,
and clustering/grouping information. The function supports two grouping methods:
equal-sized groups (`"grouped"`) or interval-based groups (`"interval"`).
Optionally, a calibration plot can be produced with cluster-specific curves.
}
\details{
- `"grouped"`: predictions are divided into equal-sized bins using quantiles.
- `"interval"`: predictions are divided into fixed-width bins across [0, 1].

The function performs a meta-analysis within each group. This can be either a univariate or bivariate analysis,
which is specified in the \code{univariate} argument. The univariate analysis is performed using the
\code{\link[meta]{metaprop}} function and the bivariate analysis employs the \code{\link[metafor]{rma.mv}} function.
Hereafter, the results are aggregated and plotted as calibration curves.
}
